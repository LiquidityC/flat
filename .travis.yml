sudo: required
dist: trusty
language: cpp
compiler:
    - gcc
   #- clang

env:
    global:
        - secure: "wVlHl1Ye7Tx5cFXM8f5pVEcG9R3DwN3cXrtSY84cUPcKsn5gW5wo8njDDRsZ3FzHYIhS/tVvmOBDgoWZg1bO6nUXF9qJ37HUzWkFVw7cG1aL3dhIzbJDCoo19JfZ04DC9+5nYaJhhHC/yJfjjzV0dDtyISivyFljKcJCjbRm06xCLDhzaMG74OV6b3m7W3cBk5uiYqufqBuonsvoocUHoUwK/KlPUAGUoXEJAuaurj/VBZG8/vvuxznYIlOQldQwhvkFOh2zLtHrZmD4NVb7FEX5pkjMIl4yUxbZ1StRkrQdQIJrhQ8vIK05x11yonAW4FUs1/IoAh5TxCQdk27oEwvMcJzqwWlnJwLHFqnP3mQhSu58foZgk2iLZi9IeHSozONRjwJORgal2MuoO4+LN5zWiex/sIbPEynpfp605eSJ7P3+trABIxOmUYWCgbI4ZB3gAgyLeZXOc9mW/ghfVVtp7wyn7iTbaw7Orcw4Q+B+pYIrCLhlCmfcLMAuhPaUGt2BzNCXGycCsEHkuBHmH7COhm5pXw/UQFByT2KTCYzgqsgaJ09XTyutzuJDvZkt/kJGZT4awQXC/cm7woq4dkVWunD6nt5t0DL2ZYq/F3yvE6G+kl9bsNugDMkKbEB6zkjTmLhnyibuh5jDxaAUbWV0UbTa83Z4onduLUO959o="

before_install:
    - sudo add-apt-repository -y ppa:zoogie/sdl2-snapshots
    - sudo add-apt-repository -y ppa:george-edison55/cmake-3.x
    - sudo add-apt-repository -y ppa:h-rayflood/llvm
    - pip install --user cpp-coveralls

      #g++4.9
    - if [ "$CXX" = "g++" ]; then sudo add-apt-repository -y ppa:ubuntu-toolchain-r/test; fi

      #clang 3.6
    - if [ "$CXX" == "clang++" ]; then sudo add-apt-repository -y ppa:h-rayflood/llvm; fi

    - sudo apt-get update -qq
    - echo -n | openssl s_client -connect scan.coverity.com:443 | sed -ne '/-BEGIN CERTIFICATE-/,/-END CERTIFICATE-/p' | sudo tee -a /etc/ssl/certs/ca-

install:
    - sudo apt-get install -y libsqlite3-dev
    - sudo apt-get install -y libsdl2-dev libsdl2-image-dev libsdl2-mixer-dev libsdl2-ttf-dev
    - sudo apt-get install -y python2.7
    - sudo apt-get install -y cmake cmake-data

      #g++6
    - if [ "$CXX" = "g++" ]; then sudo apt-get install -y g++-6; fi
    - if [ "$CXX" = "g++" ]; then export CXX="g++-6" CC="gcc-6"; fi

      #clang 3.6
    - if [ "$CXX" == "clang++" ]; then sudo apt-get install -y --allow-unauthenticated clang-3.6; fi
    - if [ "$CXX" == "clang++" ]; then export CXX="clang++-3.6"; fi

before_script:
    - sudo dpkg -L libsdl2-dev
    - sudo dpkg -L libsdl2-image-dev
    - sudo dpkg -L libsdl2-ttf-dev
    - sudo dpkg -L libsdl2-mixer-dev

script:
    - mkdir build
    - cd build
    - cmake ..
    - make
    - make check
    - make lint

after_success:
    - coveralls -e catch.hpp --gcov-options '\-lp'

addons:
    coverity_scan:
        project:
            name: "LiquidityC/flat"
            description: "Build submitted via Travis CI"
            notification_email: linus.probert@gmail.com
            build_command_prepend: "mkdir build; cd build; cmake .."
            build_command: "make -j 4"
            branch_pattern: coverity_scan
