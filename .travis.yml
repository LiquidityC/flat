sudo: required
dist: trusty
language: cpp
compiler:
    - gcc
   #- clang

env:
    global:
        - secure: "LIwNXeWbzk2YY7tj8ICDU8IxkKfxbkbX6FPzEA2u66K9FwpXgZALPAFYDeAHRrxq3h8Ta9LfwLxiZYbuwhs3ZwLwevOWEBGfsySlAIU/maALevr0P8nHEY354f4PCkF4ZmQZy+72aGNa+kXeer1QQIpUPLhhACxFB+fqcfFwFTiQQk0qj4/sCHlS/awXrP0YjtIOW9IJm4fLrIaLDZgxIXlBR5Fova8ciNyS7QRJJb8qz15RVjqr6ydD6b+E00FKZ8bZqPKi/MkOmvcQMbjr8lafR5LowybBmfBswTfFHjv34NmOqlqtEFOgI3KNqbehL74D+iObDTu+rvskj49WWpCIzQOQ9mzqteWF6rC/w8fMAdSw87axrmhWRp6b818Q+z4WhKhYjtZchyu8Sc+z7E3nc00fw1HqYU5JLZjOiX3yjwiLKcjtI7nvVaajKA/TT9L4g7j/ZehAbhvmN/sDqpsFncVtYsWQAfdGSVkImtAMrRprAFtbMAk+4fMCQKT/Gqdo/20J2vhoM2yJSKEMEeXqK7o2MaRL0wiytjcaTG+TQiWL3Pb4Q+xwVZ0E3D+I1WquSpgP3qxiv02DbXJyvb+fEn7OjXWjW6Z0Jqda5+6ewTH+NW9D81R8udSAlEhbj85K6sVYYRHQ9QBQ70Q0MZelMDHWmAh28xWOr4H+3xo="

before_install:
    - sudo add-apt-repository -y ppa:zoogie/sdl2-snapshots
    - sudo add-apt-repository -y ppa:george-edison55/cmake-3.x
    - sudo add-apt-repository -y ppa:h-rayflood/llvm
    - pip install --user cpp-coveralls

      #g++4.9
    - if [ "$CXX" = "g++" ]; then sudo add-apt-repository -y ppa:ubuntu-toolchain-r/test; fi

      #clang 3.6
    - if [ "$CXX" == "clang++" ]; then sudo add-apt-repository -y ppa:h-rayflood/llvm; fi

    - sudo apt-get update -qq
    - echo -n | openssl s_client -connect scan.coverity.com:443 | sed -ne '/-BEGIN CERTIFICATE-/,/-END CERTIFICATE-/p' | sudo tee -a /etc/ssl/certs/ca-

install:
    - sudo apt-get install -y libsqlite3-dev
    - sudo apt-get install -y libsdl2-dev libsdl2-image-dev libsdl2-mixer-dev libsdl2-ttf-dev
    - sudo apt-get install -y python2.7
    - sudo apt-get install -y cmake cmake-data

      #g++6
    - if [ "$CXX" = "g++" ]; then sudo apt-get install -y g++-6; fi
    - if [ "$CXX" = "g++" ]; then export CXX="g++-6" CC="gcc-6"; fi

      #clang 3.6
    - if [ "$CXX" == "clang++" ]; then sudo apt-get install -y --allow-unauthenticated clang-3.6; fi
    - if [ "$CXX" == "clang++" ]; then export CXX="clang++-3.6"; fi

before_script:
    - sudo dpkg -L libsdl2-dev
    - sudo dpkg -L libsdl2-image-dev
    - sudo dpkg -L libsdl2-ttf-dev
    - sudo dpkg -L libsdl2-mixer-dev

script:
    - mkdir build
    - cd build
    - cmake -DCMAKE_BUILD_TYPE=travis ..
    - make
    - make check
    - make lint

after_success:
    - coveralls -r CMakeFiles/test_flat.dir

addons:
    coverity_scan:
        project:
            name: "LiquidityC/flat"
            description: "Build submitted via Travis CI"
            notification_email: linus.probert@gmail.com
            build_command_prepend: "mkdir build; cd build; cmake .."
            build_command: "make -j 4"
            branch_pattern: coverity_scan
